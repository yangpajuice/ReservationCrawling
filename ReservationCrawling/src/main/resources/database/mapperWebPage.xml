<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.tistory.yangpajuice.rc.mapper.IWebPageMapper">
	<select id="checkTableExists" resultType="int">
	<![CDATA[
	    SELECT COUNT(*) FROM USER_TABLES WHERE TABLE_NAME = 'RC_WEBPAGE'
	]]>
	</select>

	<insert id="createTable">
		CREATE TABLE RC_WEBPAGE (
			SITE VARCHAR(20) NOT NULL,
			ID VARCHAR(20),
			URL VARCHAR(300) NOT NULL,
			MAIN_CATEGORY VARCHAR(100),
			SUB_CATEGORY VARCHAR(100),
			SUBJECT VARCHAR(300),
			ARTICLE VARCHAR(3000),
			LINK VARCHAR(300),
			USER_ID VARCHAR(20),
			INSERTED_DATE DATE
		)
	</insert>
	
	<insert id="insertWebPageItem" parameterType="com.tistory.yangpajuice.rc.item.WebPageItem">
	    INSERT INTO RC_WEBPAGE
	    (
		    SITE, ID, URL, MAIN_CATEGORY, SUB_CATEGORY, SUBJECT, 
		    ARTICLE, LINK, USER_ID, INSERTED_DATE
    	)
	    VALUES
	    (
		    #{site}, #{id}, #{url}, #{mainCategory}, #{subCategory}, #{subject}, 
		    #{article}, #{link}, #{userId}, TO_DATE(#{insertedDate}, 'YYYYMMDDHH24MISS')
	    )
	</insert>
	
	<select id="getMaxIdWebPageItem" resultType="String" parameterType="com.tistory.yangpajuice.rc.param.WebPageParam" >
		SELECT MAX(ID)
		FROM RC_WEBPAGE
		WHERE URL LIKE #{url}||'%'
  	</select>
</mapper>